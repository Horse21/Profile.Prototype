<mat-card class="c-h21-profile-user-card">

	<div class="c-h21-profile-user-card_header">
		<mat-card-title class="c-h21-profile-user-card_title">{{entity.firstName}} {{entity.lastName}}</mat-card-title>
		<mat-card-header>
			<div mat-card-avatar>
				<button *ngIf="editable" class="c-h21-profile-user-card_upload-avatar-button"
						(click)="fileInput.click()">
					<span>Add photo</span>
				</button>
			</div>
			<input #fileInput type="file" style="display:none;"/>

			<input id="fileToUpload" type="file" style="display:none;">
			<!--<img mat-card-avatar src="" alt=""/>-->
			<div class="c-h21-profile-user-card_meta-data-box">
				<div class="row">
					<div class="col-12 col-xl-6">
						<div class="row no-gutters c-h21-profile-user-card_meta-data-item">
							<div class="col-6">Date of registration</div>
							<div class="col-6"><b>{{entity.createDate?.date}} {{entity.createDate?.time}}</b></div>
						</div>
					</div>
					<div class="col-12 col-xl-6">
						<div class="row no-gutters c-h21-profile-user-card_meta-data-item">
							<div class="col-6 col-xl-4">Identity user ID:</div>
							<div class="col-6 col-xl-8"><b>{{entity.identityUserId}}</b></div>
						</div>
					</div>
					<div class="col-12 col-xl-6">
						<div class="row no-gutters c-h21-profile-user-card_meta-data-item">
							<div class="col-6">Date of update</div>
							<div class="col-6"><b>15:03:2018 15:58:19</b></div>
						</div>
					</div>
					<div class="col-12 col-xl-6">
						<div class="row no-gutters c-h21-profile-user-card_meta-data-item">
							<div class="col-6 col-xl-4">Status</div>
							<div class="col-6 col-xl-8"><b>{{vocabulary.nameById(vocabulary.state, entity.stateId)}}</b>
							</div>
						</div>
					</div>
				</div>
			</div>
		</mat-card-header>
	</div>

	<mat-card-content>
		<mat-tab-group>

			<!-- General info tab -->
			<mat-tab label="General Info">
				<h4 class="c-h21-profile-user-card_title">General info</h4>
				<div class="row">
					<div class="col-6">
						<mat-form-field class="c-h21-profile-user-card_form-field" [class.__is-readonly]="!editable">
							<input matInput placeholder="Legal Name" [readonly]="!editable"
								   [(ngModel)]="entity.legalName" required>
							<span matSuffix class="c-h21-profile-user-card_required"
								  *ngIf="!validator.invalid('entity.legalName')">*</span>
							<mat-icon matSuffix *ngIf="validator.invalid('entity.legalName')" color="warn">error
							</mat-icon>
							<mat-error *ngIf="validator.invalid('entity.legalName')">
								{{validator.invalid('entity.legalName')}}
							</mat-error>
						</mat-form-field>
						<mat-form-field class="c-h21-profile-user-card_form-field" [class.__is-readonly]="!editable">
							<input matInput placeholder="Branding Name" [readonly]="!editable">
						</mat-form-field>
						<mat-form-field class="c-h21-profile-user-card_form-field" [class.__is-readonly]="!editable">
							<mat-select placeholder="Company Types" value="v1">
								<mat-option value="v1">Value 1</mat-option>
							</mat-select>
						</mat-form-field>
						<mat-form-field class="c-h21-profile-user-card_form-field" [class.__is-readonly]="!editable">
							<mat-select placeholder="Speciality" value="v1">
								<mat-option value="v1">Value 1</mat-option>
							</mat-select>
						</mat-form-field>
					</div>
					<div class="col-6">
						<mat-form-field class="c-h21-profile-user-card_form-field" [class.__is-readonly]="!editable">
							<input matInput placeholder="Company Registration Number" [readonly]="!editable"
								   [(ngModel)]="entity.companyRegistrationNumber" required>
							<span matSuffix class="c-h21-profile-user-card_required"
								  *ngIf="!validator.invalid('entity.companyRegistrationNumber')">*</span>
							<mat-icon matSuffix *ngIf="validator.invalid('entity.companyRegistrationNumber')"
									  color="warn">error
							</mat-icon>
							<mat-error *ngIf="validator.invalid('entity.companyRegistrationNumber')">
								{{validator.invalid('entity.companyRegistrationNumber')}}
							</mat-error>
						</mat-form-field>
						<mat-form-field class="c-h21-profile-user-card_form-field" [class.__is-readonly]="!editable">
							<input matInput placeholder="Vat Number" [readonly]="!editable"
								   [(ngModel)]="entity.vatNumber" required>
							<span matSuffix class="c-h21-profile-user-card_required"
								  *ngIf="!validator.invalid('entity.vatNumber')">*</span>
							<mat-icon matSuffix *ngIf="validator.invalid('entity.vatNumber')" color="warn">error
							</mat-icon>
							<mat-error *ngIf="validator.invalid('entity.vatNumber')">
								{{validator.invalid('entity.vatNumber')}}
							</mat-error>
						</mat-form-field>
						<mat-form-field class="c-h21-profile-user-card_form-field" [class.__is-readonly]="!editable">
							<input matInput placeholder="Code" [readonly]="!editable">
						</mat-form-field>
						<mat-form-field class="c-h21-profile-user-card_form-field" [class.__is-readonly]="!editable">
							<input matInput placeholder="About" [readonly]="!editable"
								   [(ngModel)]="entity.description">
						</mat-form-field>
					</div>
				</div>

				<h5 class="c-h21-profile-user-card_subtitle">Contact fields</h5>
				<div class="row">
					<div class="col-6">
						<mat-form-field class="c-h21-profile-user-card_form-field" [class.__is-readonly]="!editable">
							<input matInput placeholder="Web site" [readonly]="!editable" [(ngModel)]="entity.website">
						</mat-form-field>
						<mat-form-field class="c-h21-profile-user-card_form-field" [class.__is-readonly]="!editable">
							<input matInput placeholder="Phone" [readonly]="!editable" [(ngModel)]="entity.phone">
						</mat-form-field>
					</div>
					<div class="col-6">
						<mat-form-field class="c-h21-profile-user-card_form-field" [class.__is-readonly]="!editable">
							<input matInput placeholder="General e-mail" [readonly]="!editable" [(ngModel)]="entity.email">
						</mat-form-field>
						<mat-form-field class="c-h21-profile-user-card_form-field" [class.__is-readonly]="!editable">
							<input matInput placeholder="Fax" [readonly]="!editable" [(ngModel)]="entity.fax">
						</mat-form-field>
					</div>
				</div>

				<h5 class="c-h21-profile-user-card_subtitle">Address</h5>
				<div class="row">
					<div class="col-6">
						<mat-form-field class="c-h21-profile-user-card_form-field"
										[class.__is-readonly]="!editable || !entity.countryCode">
							<mat-select [(value)]="entity.countryCode" placeholder="Country">
								<mat-option *ngFor="let country of countriesData" [value]="country.code">
									{{country.name}}
								</mat-option>
							</mat-select>
						</mat-form-field>
						<mat-form-field class="c-h21-profile-user-card_form-field"
										[class.__is-readonly]="!editable || !entity.countryCode">
							<mat-select [(value)]="entity.cityCode" placeholder="City">
								<mat-option *ngFor="let city of citiesData" [value]="city.code">{{city.name}}
								</mat-option>
							</mat-select>
						</mat-form-field>
						<mat-form-field class="c-h21-profile-user-card_form-field" [class.__is-readonly]="!editable">
							<input matInput placeholder="Address" [readonly]="!editable" [(ngModel)]="entity.address">
						</mat-form-field>
					</div>
					<div class="col-6">
						<mat-form-field class="c-h21-profile-user-card_form-field" [class.__is-readonly]="!editable">
							<input matInput placeholder="Postcode" [readonly]="!editable" [(ngModel)]="entity.postcode">
						</mat-form-field>
						<mat-form-field class="c-h21-profile-user-card_form-field" [class.__is-readonly]="!editable">
							<mat-select placeholder="Currency" [disabled]="!editable" [(ngModel)]="entity.currencyCode">
								<mat-option *ngFor="let currency of currencies" [value]="currency.code">
									{{currency.name}}
								</mat-option>
							</mat-select>
						</mat-form-field>
						<mat-form-field class="c-h21-profile-user-card_form-field" [class.__is-readonly]="!editable">
							<mat-select placeholder="Status" value="a">
								<mat-option value="a">Active</mat-option>
								<mat-option value="b">Blocked</mat-option>
							</mat-select>
						</mat-form-field>
					</div>
				</div>
				<div *ngIf="editable" class="c-h21-profile-user-card_action-buttons">
					<button mat-stroked-button color="primary">Cancel</button>
					<button mat-raised-button color="primary">Save</button>
				</div>
			</mat-tab>

			<!-- Branches tab -->
			<mat-tab label="Branches">
				<div class="row no-gutters">
					<div class="col-6">
						<h4 class="c-h21-profile-user-card_title mb-0">Branches</h4>
					</div>
					<div class="col-6 __text-right">
						<button mat-raised-button color="primary" (click)="addNewFolderRow()" *ngIf="editable">Add new row</button>
					</div>
				</div>
				<table mat-table [dataSource]="branchesData" class="profile-table">
					<!-- Name Column -->
					<ng-container matColumnDef="name">
						<th mat-header-cell *matHeaderCellDef [width]="'40%'">Name</th>
						<td mat-cell *matCellDef="let element"> {{element.name}}</td>
					</ng-container>
					<!-- Code Column -->
					<ng-container matColumnDef="code">
						<th mat-header-cell *matHeaderCellDef [width]="'20%'">Code</th>
						<td mat-cell *matCellDef="let element"> {{element.code}}</td>
					</ng-container>
					<!-- Status Column -->
					<ng-container matColumnDef="status">
						<th mat-header-cell *matHeaderCellDef [width]="'20%'">Status</th>
						<td mat-cell *matCellDef="let element"> {{element.status}}</td>
					</ng-container>
					<!-- Actions Column -->
					<ng-container matColumnDef="actions">
						<th mat-header-cell *matHeaderCellDef [width]="'20%'">&nbsp;</th>
						<td mat-cell *matCellDef="let element" class="__text-right __nowrap">
							<button mat-icon-button (click)="viewLink(element.id);" matTooltip="View">
								<mat-icon>visibility</mat-icon>
							</button>
							<button mat-icon-button (click)="editLink(element.id);" [disabled]="!editable"
									matTooltip="Edit">
								<mat-icon>edit</mat-icon>
							</button>
							<button mat-icon-button class="profile-table_removed-row-button" [disabled]="!editable"
									matTooltip="Remove">
								<mat-icon>delete</mat-icon>
							</button>
						</td>
					</ng-container>
					<tr mat-header-row *matHeaderRowDef="branchesDisplayedColumns"></tr>
					<tr mat-row *matRowDef="let row; columns: branchesDisplayedColumns;"
						class="profile-table_removed-row"></tr>
				</table>
			</mat-tab>

			<!-- Agents tab -->
			<mat-tab label="Agents">
				<h4 class="c-h21-profile-user-card_title">Agents</h4>
				<table mat-table [dataSource]="agentsData" class="profile-table">

					<!-- Name Column -->
					<ng-container matColumnDef="name">
						<th mat-header-cell *matHeaderCellDef [width]="'25%'">Name</th>
						<td mat-cell *matCellDef="let element"> {{element.name}}</td>
					</ng-container>

					<!-- Agency Column -->
					<ng-container matColumnDef="agency">
						<th mat-header-cell *matHeaderCellDef [width]="'20%'">Agency</th>
						<td mat-cell *matCellDef="let element"> {{element.agency}}</td>
					</ng-container>

					<!-- Create Column -->
					<ng-container matColumnDef="create">
						<th mat-header-cell *matHeaderCellDef [width]="'20%'">Create</th>
						<td mat-cell *matCellDef="let element"> {{element.create}}</td>
					</ng-container>

					<!-- Change Column -->
					<ng-container matColumnDef="change">
						<th mat-header-cell *matHeaderCellDef [width]="'15%'">Change</th>
						<td mat-cell *matCellDef="let element"> {{element.change}}</td>
					</ng-container>

					<!-- Status Column -->
					<ng-container matColumnDef="status">
						<th mat-header-cell *matHeaderCellDef [width]="'15%'">Status</th>
						<td mat-cell *matCellDef="let element"> {{element.status}}</td>
					</ng-container>

					<!-- Ellipsis Column -->
					<ng-container matColumnDef="ellipsis">
						<th mat-header-cell *matHeaderCellDef [width]="'5%'">&nbsp</th>
						<td mat-cell *matCellDef="let element">
							<mat-icon class="">more_horiz</mat-icon>
						</td>
					</ng-container>

					<tr mat-header-row *matHeaderRowDef="agentsDisplayedColumns"></tr>
					<tr mat-row *matRowDef="let row; columns: agentsDisplayedColumns;"></tr>
				</table>
			</mat-tab>

			<!-- Providers tab -->
			<mat-tab label="Providers">
				<h4 class="c-h21-profile-user-card_title">Providers</h4>
				<table mat-table [dataSource]="providersData" class="profile-table">

					<!-- Name Column -->
					<ng-container matColumnDef="name">
						<th mat-header-cell *matHeaderCellDef [width]="'25%'">Name</th>
						<td mat-cell *matCellDef="let element"> {{element.name}}</td>
					</ng-container>

					<!-- Type Column -->
					<ng-container matColumnDef="type">
						<th mat-header-cell *matHeaderCellDef [width]="'20%'">Type</th>
						<td mat-cell *matCellDef="let element"> {{element.type}}</td>
					</ng-container>

					<!-- Create Column -->
					<ng-container matColumnDef="create">
						<th mat-header-cell *matHeaderCellDef [width]="'20%'">Create</th>
						<td mat-cell *matCellDef="let element"> {{element.create}}</td>
					</ng-container>

					<!-- Change Column -->
					<ng-container matColumnDef="change">
						<th mat-header-cell *matHeaderCellDef [width]="'15%'">Change</th>
						<td mat-cell *matCellDef="let element"> {{element.change}}</td>
					</ng-container>

					<!-- Status Column -->
					<ng-container matColumnDef="status">
						<th mat-header-cell *matHeaderCellDef [width]="'15%'">Status</th>
						<td mat-cell *matCellDef="let element"> {{element.status}}</td>
					</ng-container>

					<!-- Ellipsis Column -->
					<ng-container matColumnDef="ellipsis">
						<th mat-header-cell *matHeaderCellDef [width]="'5%'">&nbsp</th>
						<td mat-cell *matCellDef="let element">
							<mat-icon class="">more_horiz</mat-icon>
						</td>
					</ng-container>

					<tr mat-header-row *matHeaderRowDef="providersDisplayedColumns"></tr>
					<tr mat-row *matRowDef="let row; columns: providersDisplayedColumns;"></tr>
				</table>
			</mat-tab>

			<!-- History tab -->
			<mat-tab label="History">
				<h4 class="c-h21-profile-user-card_title">History</h4>
				<table mat-table [dataSource]="historyData" class="profile-table" multiTemplateDataRows>
					<!-- Expand button Column -->
					<ng-container matColumnDef="expand">
						<th mat-header-cell *matHeaderCellDef [width]="'4%'">&nbsp;</th>
						<td mat-cell *matCellDef="let element" class="profile-table_no-padding">
							<button class="profile-table_expand-button" mat-icon-button
									(click)="historyExpandedElement = element" *ngIf="historyExpandedElement != element"
									matTooltip="Show detail">
								<mat-icon>chevron_right</mat-icon>
							</button>
							<button class="profile-table_expand-button" mat-icon-button
									(click)="historyExpandedElement = null" *ngIf="historyExpandedElement == element"
									matTooltip="Hide detail">
								<mat-icon>expand_more</mat-icon>
							</button>
						</td>
					</ng-container>
					<!-- Date Column -->
					<ng-container matColumnDef="date">
						<th mat-header-cell *matHeaderCellDef [width]="'32%'">Date</th>
						<td mat-cell *matCellDef="let element"> {{element.date | date: 'MM.dd.yyyy HH:mm'}}</td>
					</ng-container>
					<!-- Action Column -->
					<ng-container matColumnDef="action">
						<th mat-header-cell *matHeaderCellDef [width]="'32%'">Action</th>
						<td mat-cell *matCellDef="let element"> {{element.action}}</td>
					</ng-container>
					<!-- User Column -->
					<ng-container matColumnDef="user">
						<th mat-header-cell *matHeaderCellDef [width]="'32%'">User</th>
						<td mat-cell *matCellDef="let element"> {{element.user}}</td>
					</ng-container>
					<!-- Expanded Content-->
					<ng-container matColumnDef="expandedDetail">
						<td mat-cell *matCellDef="let element" [attr.colspan]="historyDisplayedColumns.length"
							class="profile-table_no-padding">
							<div class="expanded-detail"
								 [class.expanded-detail__active]="historyExpandedElement === element">
								<table mat-table [dataSource]="element.expandData"
									   class="profile-table profile-table__expanded-table">
									<ng-container matColumnDef="blank">
										<th mat-header-cell *matHeaderCellDef [width]="'4%'">&nbsp;</th>
										<td mat-cell *matCellDef>&nbsp;</td>
									</ng-container>
									<ng-container matColumnDef="field">
										<th mat-header-cell *matHeaderCellDef [width]="'32%'">Field</th>
										<td mat-cell *matCellDef="let expElement"> {{expElement.field}}</td>
									</ng-container>
									<ng-container matColumnDef="oldValue">
										<th mat-header-cell *matHeaderCellDef [width]="'32%'">oldValue</th>
										<td mat-cell *matCellDef="let expElement" class="__text-strike">
											{{expElement.oldValue}}
										</td>
									</ng-container>
									<ng-container matColumnDef="newValue">
										<th mat-header-cell *matHeaderCellDef [width]="'32%'">newValue</th>
										<td mat-cell *matCellDef="let expElement"> {{expElement.newValue}}</td>
									</ng-container>

									<tr mat-header-row *matHeaderRowDef="historyExpandDisplayedColumns"></tr>
									<tr mat-row
										*matRowDef="let expElement; columns: historyExpandDisplayedColumns;"></tr>
								</table>
							</div>
						</td>
					</ng-container>
					<tr mat-header-row *matHeaderRowDef="historyDisplayedColumns"></tr>
					<tr mat-row *matRowDef="let element; columns: historyDisplayedColumns;"
						[class.profile-table_expanded-row]="historyExpandedElement === element"></tr>
					<tr mat-row *matRowDef="let element; columns: ['expandedDetail']"
						class="profile-table_expanded-row-detail"></tr>
				</table>
			</mat-tab>
		</mat-tab-group>
	</mat-card-content>
</mat-card>
